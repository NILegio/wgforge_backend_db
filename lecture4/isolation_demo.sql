#run 1st psql
$ PGPASSWORD=wgforge /usr/lib/postgresql/11/bin/psql -h localhost -p 5436 -U wgforge
localhost wgforge@wgforge=> SELECT * from money;
┌────┬───────────┬───────────────┬────────┬───────────────────────────┬───────────────────────────┐
│ id │ player_id │ currency_code │ amount │          created          │          updated          │
├────┼───────────┼───────────────┼────────┼───────────────────────────┼───────────────────────────┤
│ 39 │        53 │ gold          │  90000 │ 2019-05-27 03:55:19.09664 │ 2019-05-27 03:55:19.09664 │
│ 38 │        53 │ silver        │   1000 │ 2019-05-27 03:55:19.09664 │ 2019-05-27 03:55:19.09664 │
└────┴───────────┴───────────────┴────────┴───────────────────────────┴───────────────────────────┘

# run 2nd psql
$ PGPASSWORD=wgforge /usr/lib/postgresql/11/bin/psql -h localhost -p 5436 -U wgforge
localhost wgforge@wgforge=> SELECT * from money;
┌────┬───────────┬───────────────┬────────┬───────────────────────────┬───────────────────────────┐
│ id │ player_id │ currency_code │ amount │          created          │          updated          │
├────┼───────────┼───────────────┼────────┼───────────────────────────┼───────────────────────────┤
│ 39 │        53 │ gold          │  90000 │ 2019-05-27 03:55:19.09664 │ 2019-05-27 03:55:19.09664 │
│ 38 │        53 │ silver        │   1000 │ 2019-05-27 03:55:19.09664 │ 2019-05-27 03:55:19.09664 │
└────┴───────────┴───────────────┴────────┴───────────────────────────┴───────────────────────────┘


# BEGIN transaction in 1st psql

localhost wgforge@wgforge=> SELECT id as player1_id from player where nickname='vasya' \gset
localhost wgforge@wgforge=> BEGIN
localhost wgforge@wgforge=> update money set amount = amount + 100 where player_id=:player1_id and currency_code='silver';
localhost wgforge@wgforge=> SELECT * from money;
┌────┬───────────┬───────────────┬────────┬───────────────────────────┬───────────────────────────┐
│ id │ player_id │ currency_code │ amount │          created          │          updated          │
├────┼───────────┼───────────────┼────────┼───────────────────────────┼───────────────────────────┤
│ 39 │        53 │ gold          │  90000 │ 2019-05-27 03:55:19.09664 │ 2019-05-27 03:55:19.09664 │
│ 38 │        53 │ silver        │   1100 │ 2019-05-27 03:55:19.09664 │ 2019-05-27 03:55:19.09664 │
└────┴───────────┴───────────────┴────────┴───────────────────────────┴───────────────────────────┘


# see in 2nd psql, what happend with money table
localhost wgforge@wgforge=> SELECT * from money;
┌────┬───────────┬───────────────┬────────┬───────────────────────────┬───────────────────────────┐
│ id │ player_id │ currency_code │ amount │          created          │          updated          │
├────┼───────────┼───────────────┼────────┼───────────────────────────┼───────────────────────────┤
│ 39 │        53 │ gold          │  90000 │ 2019-05-27 03:55:19.09664 │ 2019-05-27 03:55:19.09664 │
│ 38 │        53 │ silver        │   1000 │ 2019-05-27 03:55:19.09664 │ 2019-05-27 03:55:19.09664 │
└────┴───────────┴───────────────┴────────┴───────────────────────────┴───────────────────────────┘



# COMMIT transaction in 1st psql
localhost wgforge@wgforge=> COMMIT


# see in 2nd psql, what happend with money table
localhost wgforge@wgforge=> SELECT * from money;
┌────┬───────────┬───────────────┬────────┬───────────────────────────┬───────────────────────────┐
│ id │ player_id │ currency_code │ amount │          created          │          updated          │
├────┼───────────┼───────────────┼────────┼───────────────────────────┼───────────────────────────┤
│ 39 │        53 │ gold          │  90000 │ 2019-05-27 03:55:19.09664 │ 2019-05-27 03:55:19.09664 │
│ 38 │        53 │ silver        │   1100 │ 2019-05-27 03:55:19.09664 │ 2019-05-27 03:55:19.09664 │
└────┴───────────┴───────────────┴────────┴───────────────────────────┴───────────────────────────┘
